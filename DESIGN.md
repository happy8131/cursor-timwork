# 설계 문서

## 데이터 분석

### metadata.json 해석

메타데이터는 3단계 계층 구조를 갖습니다:

```
전체 배치도 (00)
├── 건물 (Drawing)
│   ├── 공종 (Discipline)
│   │   ├── 리비전 (Revision)
│   │   └── 영역 (Region) → 리비전
```

**핵심 관찰:**
- 모든 도면은 `parent` 필드로 트리 관계를 형성 (00이 루트)
- 공종별로 독립된 도면 이미지와 좌표 변환(imageTransform) 보유
- 구조 공종은 Region A/B로 영역 분할되어 독립 리비전 관리
- 주민공동시설 건축은 discipline 레벨에 polygon이 없고 각 revision마다 독립 polygon 보유 (특수 케이스)

### 더 나은 데이터 표현

현재 구조는 도면 ID가 파일 접두사 번호(00, 01, 09, 13)로 되어 있어 불연속적입니다.
건물-층-공종을 복합키로 사용하거나, 별도의 `buildings` 배열로 건물 정보를 분리하면
공간 계층(단지→동→층)과 공종 계층을 독립적으로 탐색할 수 있어 더 유연할 것입니다.

## 접근 방식

1. **데이터 모델링** — metadata.json의 모든 필드를 TypeScript 타입으로 정의
2. **상태 설계** — 사용자가 선택한 (도면, 공종, 영역, 리비전) 4단계 상태를 zustand로 관리
3. **UI 컴포넌트** — 탐색(사이드바) + 표시(뷰어) + 인식(브레드크럼/정보패널) 3축으로 분리
4. **점진적 구현** — 기본 뷰어 → 네비게이션 → 인터랙션 순으로 구현

## UI 설계 결정

### 레이아웃: 3패널 구조

```
┌─────────────────────────────────────────┐
│ Header (브레드크럼 + 검색)                │
├──────────┬──────────────────────────────┤
│          │                              │
│ Sidebar  │    Drawing Viewer            │
│ (탐색)   │    (줌/팬 가능)               │
│          │                              │
│          ├──────────────────────────────┤
│          │ Info Panel (도면 정보)         │
└──────────┴──────────────────────────────┘
```

**선택 이유:**
- 건설 도면 뷰어의 핵심은 "넓은 도면 표시 영역"이므로 뷰어가 최대 공간 차지
- 도면 탐색은 건물→공종→리비전의 깊이 있는 계층이므로 수직 사이드바가 적합
- CINK 앱의 좌측 네비게이션 + 중앙 뷰어 패턴을 웹에 맞게 적용

**고려했던 대안:**
1. **탭 기반 상단 네비게이션** — 간결하지만 건물/공종/리비전 3단계를 한 번에 표현하기 어려움
2. **트리뷰 전체 펼침** — 정보량이 많아 스크롤이 과도해짐
3. **모달/드로어 방식** — 도면 보면서 동시 탐색 불가

### 상태 관리: Zustand

- 전역 상태가 `selectedDrawingId`, `selectedDiscipline`, `selectedRegion`, `selectedRevisionVersion` 4개로 단순
- Redux나 Context API 대비 보일러플레이트 최소화
- React 19 호환성 우수

### 도면 뷰어: react-zoom-pan-pinch

- 건설 도면은 고해상도 이미지이므로 줌/팬이 필수
- 터치(핀치) 지원으로 모바일 대응
- Canvas 기반 솔루션 대비 구현 복잡도 낮음

## 기술 선택 근거

| 기술 | 선택 이유 |
|------|----------|
| Next.js 16 | App Router의 서버 컴포넌트로 초기 로딩 최적화 |
| Zustand | 4개 상태값 관리에 적합한 경량 솔루션 |
| Tailwind CSS 4 | 유틸리티 기반으로 빠른 UI 구현 |
| shadcn/ui | 디자인 시스템 일관성 + 필요한 컴포넌트만 선택 |
| react-zoom-pan-pinch | 도면 줌/팬 필수 기능을 가장 간단히 구현 |
| Lucide | 일관된 아이콘 세트, shadcn/ui 기본 아이콘 |

## 어려웠던 점 및 개선 방안

### 어려웠던 점
1. **imageTransform/polygonTransform 해석** — 두 종류의 좌표 변환이 각각 다른 맥락에서 사용되어 정확한 오버레이 구현에 복잡성 존재
2. **특수 케이스 처리** — 구조의 Region 분할, 주민공동시설의 리비전별 polygon 등 일관되지 않은 데이터 구조 대응

### 시간이 더 주어진다면
1. **도면 오버레이** — imageTransform을 활용하여 여러 공종 도면을 겹쳐 비교하는 기능
2. **리비전 diff** — 같은 공종의 이전/이후 리비전을 나란히 또는 오버레이로 비교
3. **polygon 영역 하이라이트** — 도면 위에 관심 영역을 시각적으로 표시
4. **사용자 주석** — 도면 위에 메모/마크업 추가 기능
5. **오프라인 지원** — Service Worker를 활용한 도면 캐싱
